@for (message of messages(); track message.id) {
  @let sender = message.sender;
  <div class="flex" [class]="getJustifyEndClasses(sender)">
    <div
      class="{{ `flex flex-col max-w-lg ${getItemClasses(sender)}` }}">
      <div class="flex items-center">
        @if (sender === 'AI') {
          <div class="chat-avatar-ai">A</div>
        }
        <div
          class="{{ `px-4 py-3 rounded-2xl animate-scale-in-up ${getTextColorClases(sender)}` }}"
        >
          @if (message.isLoading) {
            <div class="flex items-center space-x-2">
              <app-spinner-icon />
              <span>Editing the last image...</span>
            </div>
          } @else {
            @if (message.text) {
              <p class="{{ `text-base text-left ${message.isError ? 'flex items-center' : ''}` }}">
                @if (message.isError) {
                  <app-chat-error-icon class="mr-2" />
                }
                {{ message.text }}
              </p>
            }
            @if (message.base64) {
              <app-image-viewer
                [id]="message.id"
                [url]="message.base64"
                (imageAction)="handleImageAction($event)"
                [capabilities]="{ download: true, video: false, clearImage: false }"
                [imageSize]="{ width: 300, height: 200 }"
              />
            }
          }
        </div>
        @if (sender === 'User') {
          <div class="chat-avatar-human">H</div>
        }
      </div>
    </div>
  </div>
}
