<app-card>
  <app-card-header [name]="feature.name" [description]="feature.description"  />

  <div class="w-full max-w-2xl mx-auto">
    <app-visual-story-form
      [isLoading]="isLoading()"
      [(promptArgs)]="promptArgs"
      (generate)="handleGenerate()"
    >
      <span loading-text>{{ feature.loadingText }}</span>
      <span button-text>{{ feature.buttonText }}</span>
    </app-visual-story-form>

    <app-prompt-history
      [history]="promptHistory()"
      (promptSelected)="handleVisualStoryArgs($event)"
      (historyCleared)="onClearHistory()"
    />
  </div>

  <app-error-display [error]="error()" />

  @let imageResponses = images() || [];
  @if (isLoading()) {
    <div class="w-full h-48 bg-gray-800 rounded-lg flex flex-col justify-center items-center text-gray-500 border-2 border-dashed border-gray-700">
      <app-loader loadingText="Generating your visual story...">
        <p class="text-sm">Your generated {{ promptArgs().args.type}} will appear here. Please be patient.</p>
      </app-loader>
    </div>
  } @else {
    @if (imageResponses && imageResponses.length > 0) {
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        @for (imageResponse of imageResponses; track imageResponse.id; let i=$index) {
          <app-image-viewer class="block mt-4"
            [url]="imageResponse.inlineData"
            [loadingText]="feature.loadingText"
            [id]="imageResponse.id"
            (imageAction)="handleAction($event)"
          />
        }
      </div>
    }
    <app-video-player
    [isGeneratingVideo]="isGeneratingVideo()"
    [videoUrl]="videoUrl()"
  />
  }
</app-card>
